<html>
    <head>
        <title>Debug</title>
        <script src="/js/zepto.min.js"></script>
        <link rel="icon" href="data:,">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
          body {font-family: sans-serif;}
          
          input {
            width: 50px;
            margin-left:10px;
          }
          .item {
            display: inline-block;
            width:250px;
          }
          .value {
            display: inline-block;
            width:50px;
          }
        </style>
    </head>
    <body>
        <H1>Debug</H1>
        <a href="/">Home</a><br><br>
        <div id="debugparams">Loading...</div>
        <script>
          function initialLoad() {
            $.get('/debug_update', function(response){
              populateValues(response, true);
            });
          }
          
          function updateLoad() {
            $.get('/debug_update', function(response){
              populateValues(response, false);
            });
          }
          
          function populateValues(data, initialLoad) {
            if (initialLoad)
            {
              $('#debugparams').html('');
              if ("vehiclestatus" in data) {
                Object.keys(data.vehiclestatus).forEach((k, i) => {
                  $newDiv = $('<div id="' + k + '"/>');
                  $labelSpan = $('<span/>').addClass("item").html(k + ":");
                  $newDiv.append($labelSpan);
                  $theValue = $('<span/>').addClass('value').html(data.vehiclestatus[k]);
                  $newDiv.append($theValue);
                  $input = $('<input id="' + k + '"/>').val(data.vehiclestatus[k]).on('focus', function(e) {
                      this.select();
                    }).keypress(function (e) {
                      var key = e.which;
                      if(key == 13) {
                        $this = $(this);
                        $.post('/debug_save', { "key": $this.attr('id'), "value": $this.val() }, function(response) {
                          updateLoad();
                        });
                        this.select();
                      }
                  });
                  $newDiv.append($input);
                  
                  $('#debugparams').append($newDiv);
                });
              }
              
              if ("dynamicanalysisitems" in data) {
                
                $dynamic_toplevel = $('<div>').attr('id', 'dymanicitems');
                
                $('#debugparams').append($("<h4>Dynamic Analysis Items</h4>"));
                Object.keys(data.dynamicanalysisitems).forEach((k, i) => {
                  $newDiv = $('<div id="' + k + '"/>');
                  $labelSpan = $('<span/>').addClass("item").html(k + ":");
                  $newDiv.append($labelSpan);
                  $theValue = $('<span/>').addClass('value').html(data.dynamicanalysisitems[k]);
                  $newDiv.append($theValue);
                  
                  $dynamic_toplevel.append($newDiv);  
                });
                
                $('#debugparams').append($dynamic_toplevel);
              }
              
              if ("processeditems" in data) {
                $('#debugparams').append($("<h4>Processed Items</h4>"));
                
                $processed_toplevel = $('<div>').attr('id', 'processeditems');
                
                Object.keys(data.processeditems).forEach((k, i) => {
                  $newDiv = $('<div id="' + k + '"/>');
                  $labelSpan = $('<span/>').addClass("item").html(k + ":");
                  $newDiv.append($labelSpan);
                  $theValue = $('<span/>').addClass('value').html(data.processeditems[k]);
                  $newDiv.append($theValue);
                  
                  $processed_toplevel.append($newDiv);
                });
                
                $('#debugparams').append($processed_toplevel);
              }
            } else {
              if ("vehiclestatus" in data) {
                Object.keys(data.vehiclestatus).forEach((k, i) => {
                  $('div#' + k + ' span.value').html(data.vehiclestatus[k]);
                }); 
              }
              if ("dynamicanalysisitems" in data) {
                Object.keys(data.dynamicanalysisitems).forEach((k, i) => {
                  $('div#dymanicitems div#' + k + ' span.value').html(data.dynamicanalysisitems[k]);
                }); 
              }
              if ("processeditems" in data) {
                Object.keys(data.processeditems).forEach((k, i) => {
                  $('div#processeditems div#' + k + ' span.value').html(data.processeditems[k]);
                }); 
              }
            }
          }
          
          initialLoad();
          setInterval('updateLoad()', 1000);
        </script>
    </body>
</html>